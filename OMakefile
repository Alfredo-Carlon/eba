PROGRAM = eba

FILES[] =
    error
    utils
    pP
    uniq
    type
    axioms
    env
    funAbs
    fileAbs
    structs
    infer
    pathTree
    fileChecker
    checkUninitFile
    fiChecker
    checkFiNoret
    flow1Checker
    checkUninitFlow1
    flow2Checker
    checkDLockFlow2
    checkBhOnIrqFlow2

USE_OCAMLFIND = true
BYTE_ENABLED = true
NATIVE_ENABLED = true

OCAMLPACKS[] += batteries cil ocamlgraph smart_print cmdliner dolog
OCAMLFLAGS += -thread

OCamlLibrary(libeba, $(FILES))

OCAML_LIBS = libeba
OCamlProgram(eba, eba)

.DEFAULT: $(if $(BYTE_ENABLED), $(PROGRAM).run) \
          $(if $(NATIVE_ENABLED), $(PROGRAM).opt)

# Cleanup
.PHONY: clean
clean:
  rm -f \
     $(filter-proper-targets $(glob $(addsuffix .*, $(FILES)))) \
     libeba.cma libeba.cmxa libeba.a eba.cma eba.cmxa eba.a
